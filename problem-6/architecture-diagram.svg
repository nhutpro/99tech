<svg width="1000" height="800" xmlns="http://www.w3.org/2000/svg">
    <!-- Background with gradient -->
    <defs>
        <linearGradient id="backgroundGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#f8f9fa;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#e9ecef;stop-opacity:1" />
        </linearGradient>
        
        <!-- Drop shadow filter -->
        <filter id="dropShadow" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="2" dy="2" stdDeviation="2" flood-color="#00000015"/>
        </filter>
        
        <!-- Arrowhead definitions -->
        <marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#495057"/>
        </marker>
        <marker id="arrow-green" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#28a745"/>
        </marker>
        <marker id="arrow-blue" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#007bff"/>
        </marker>
        <marker id="arrow-red" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#dc3545"/>
        </marker>
        <marker id="arrow-orange" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#fd7e14"/>
        </marker>
    </defs>
    
    <!-- Background -->
    <rect width="100%" height="100%" fill="url(#backgroundGradient)"/>
    
    <!-- Title -->
    <text x="500" y="50" font-family="'Segoe UI', sans-serif" font-size="28" font-weight="bold" text-anchor="middle" fill="#212529">
        Real-Time Leaderboard Architecture
    </text>
    <text x="500" y="75" font-family="'Segoe UI', sans-serif" font-size="14" text-anchor="middle" fill="#6c757d">
        Scalable, Secure, and Fault-Tolerant Design
    </text>

    <!-- User Browser Component -->
    <g id="user" filter="url(#dropShadow)">
        <rect x="70" y="350" width="160" height="80" fill="#ffffff" stroke="#28a745" stroke-width="2" rx="8"/>
        <text x="150" y="380" font-family="'Segoe UI', sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#155724">User's Browser</text>
        <text x="150" y="400" font-family="'Segoe UI', sans-serif" font-size="12" text-anchor="middle" fill="#6c757d">Frontend Client</text>
        <text x="150" y="415" font-family="'Segoe UI', sans-serif" font-size="12" text-anchor="middle" fill="#6c757d">WebSocket Connection</text>
    </g>

    <!-- API Server Component -->
    <g id="api-server" filter="url(#dropShadow)">
        <rect x="350" y="200" width="220" height="100" fill="#ffffff" stroke="#495057" stroke-width="2" rx="8"/>
        <text x="460" y="240" font-family="'Segoe UI', sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#212529">API Server</text>
        <text x="460" y="260" font-family="'Segoe UI', sans-serif" font-size="14" text-anchor="middle" fill="#495057">Express.js + Node.js</text>
        <text x="460" y="280" font-family="'Segoe UI', sans-serif" font-size="12" text-anchor="middle" fill="#6c757d">/api/v1/scores/increment</text>
    </g>

    <!-- WebSocket Server Component -->
    <g id="websocket-server" filter="url(#dropShadow)">
        <rect x="350" y="450" width="220" height="100" fill="#ffffff" stroke="#495057" stroke-width="2" rx="8"/>
        <text x="460" y="490" font-family="'Segoe UI', sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#212529">WebSocket Server</text>
        <text x="460" y="510" font-family="'Segoe UI', sans-serif" font-size="14" text-anchor="middle" fill="#495057">Real-time Communication</text>
        <text x="460" y="530" font-family="'Segoe UI', sans-serif" font-size="12" text-anchor="middle" fill="#6c757d">leaderboard_update events</text>
    </g>

    <!-- Redis Cache Component -->
    <g id="redis" filter="url(#dropShadow)">
        <rect x="700" y="150" width="180" height="100" fill="#ffffff" stroke="#dc3545" stroke-width="2" rx="8"/>
        <text x="790" y="190" font-family="'Segoe UI', sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#721c24">Redis Cache</text>
        <text x="790" y="210" font-family="'Segoe UI', sans-serif" font-size="14" text-anchor="middle" fill="#dc3545">High Performance</text>
        <text x="790" y="230" font-family="'Segoe UI', sans-serif" font-size="12" text-anchor="middle" fill="#6c757d">Sorted Set: leaderboard</text>
    </g>

    <!-- PostgreSQL Database Component -->
    <g id="database" filter="url(#dropShadow)">
        <rect x="700" y="350" width="180" height="100" fill="#ffffff" stroke="#007bff" stroke-width="2" rx="8"/>
        <text x="790" y="390" font-family="'Segoe UI', sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#084298">PostgreSQL</text>
        <text x="790" y="410" font-family="'Segoe UI', sans-serif" font-size="14" text-anchor="middle" fill="#007bff">Source of Truth</text>
        <text x="790" y="430" font-family="'Segoe UI', sans-serif" font-size="12" text-anchor="middle" fill="#6c757d">Persistent Storage</text>
    </g>

    <!-- Flow Arrows -->
    
    <!-- 1. User to API Server -->
    <path d="M 230 380 Q 290 320 350 260" stroke="#495057" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
    <rect x="260" y="320" width="90" height="25" fill="#ffffff" stroke="#dee2e6" stroke-width="1" rx="12" opacity="0.95"/>
    <text x="305" y="337" font-family="'Segoe UI', sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#495057">1. POST + JWT</text>

    <!-- 2a. API Server to Database -->
    <path d="M 570 260 Q 630 300 700 380" stroke="#007bff" stroke-width="2" fill="none" marker-end="url(#arrow-blue)"/>
    <rect x="615" y="305" width="90" height="25" fill="#ffffff" stroke="#007bff" stroke-width="1" rx="12" opacity="0.95"/>
    <text x="660" y="322" font-family="'Segoe UI', sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#007bff">2a. Update DB</text>

    <!-- 2b. API Server to Redis -->
    <path d="M 570 240 Q 630 200 700 200" stroke="#dc3545" stroke-width="2" fill="none" marker-end="url(#arrow-red)"/>
    <rect x="575" y="170" width="110" height="30" fill="#ffffff" stroke="#dc3545" stroke-width="1" rx="12" opacity="0.95"/>
    <text x="630" y="190" font-family="'Segoe UI', sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#dc3545">2b. Update Cache</text>

    <!-- 3. Redis to API Server -->
    <path d="M 700 220 Q 630 240 570 250" stroke="#dc3545" stroke-width="2" fill="none" marker-end="url(#arrow-red)" stroke-dasharray="6,3"/>
    <rect x="615" y="250" width="90" height="25" fill="#ffffff" stroke="#dc3545" stroke-width="1" rx="12" opacity="0.95"/>
    <text x="660" y="267" font-family="'Segoe UI', sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#dc3545">3. Get Top 10</text>

    <!-- 4. API Server to WebSocket Server -->
    <path d="M 460 300 V 450" stroke="#495057" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
    <rect x="475" y="365" width="80" height="25" fill="#ffffff" stroke="#dee2e6" stroke-width="1" rx="12" opacity="0.95"/>
    <text x="515" y="382" font-family="'Segoe UI', sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#495057">4. Trigger</text>

    <!-- 5. WebSocket Server to User -->
    <path d="M 350 480 Q 290 440 230 410" stroke="#28a745" stroke-width="2" fill="none" marker-end="url(#arrow-green)"/>
    <rect x="260" y="435" width="90" height="25" fill="#ffffff" stroke="#28a745" stroke-width="1" rx="12" opacity="0.95"/>
    <text x="305" y="452" font-family="'Segoe UI', sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#28a745">5. Live Update</text>
    
    <!-- Initial WebSocket connection -->
    <path d="M 230 420 Q 290 510 350 520" stroke="#17a2b8" stroke-width="2" fill="none" marker-end="url(#arrow-blue)" stroke-dasharray="8,4"/>
    <rect x="260" y="485" width="90" height="25" fill="#ffffff" stroke="#17a2b8" stroke-width="1" rx="12" opacity="0.95"/>
    <text x="305" y="502" font-family="'Segoe UI', sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#17a2b8">Initial Connect</text>

    <!-- Recovery mechanism -->
    <path d="M 790 350 Q 820 300 820 250" stroke="#fd7e14" stroke-width="2" fill="none" marker-end="url(#arrow-orange)" stroke-dasharray="10,5"/>
    <rect x="825" y="285" width="80" height="25" fill="#ffffff" stroke="#fd7e14" stroke-width="1" rx="12" opacity="0.95"/>
    <text x="865" y="302" font-family="'Segoe UI', sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#fd7e14">Recovery</text>

    <!-- Simplified Legend -->
    <g id="legend" filter="url(#dropShadow)">
        <rect x="70" y="620" width="600" height="120" fill="#ffffff" stroke="#dee2e6" stroke-width="1" rx="8"/>
        <text x="85" y="640" font-family="'Segoe UI', sans-serif" font-size="16" font-weight="bold" fill="#212529">Data Flow Legend</text>
        
        <rect x="85" y="655" width="12" height="12" fill="#007bff" rx="2"/>
        <text x="105" y="665" font-family="'Segoe UI', sans-serif" font-size="13" fill="#495057">Primary Database Operations (Persistent)</text>
        
        <rect x="85" y="675" width="12" height="12" fill="#dc3545" rx="2"/>
        <text x="105" y="685" font-family="'Segoe UI', sans-serif" font-size="13" fill="#495057">Redis Cache Operations (Fast Access)</text>
        
        <rect x="85" y="695" width="12" height="12" fill="#28a745" rx="2"/>
        <text x="105" y="705" font-family="'Segoe UI', sans-serif" font-size="13" fill="#495057">Real-time Updates (WebSocket)</text>
        
        <rect x="85" y="715" width="12" height="12" fill="#fd7e14" rx="2"/>
        <text x="105" y="725" font-family="'Segoe UI', sans-serif" font-size="13" fill="#495057">Recovery Mechanism (Failover)</text>
    </g>
</svg>
